"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4174],{4174:(J,P,o)=>{o.r(P),o.d(P,{ScannerPageModule:()=>q});var _=o(6814),b=o(95),E=o(4969),f=o(6761),v=o(9599),S=o(5861),t=o(6689),Z=o(8537),T=o(1266);const x=["action"];function A(n,i){1&n&&(t.TgZ(0,"h2",12),t._uU(1," Ya puedes volver a escanear "),t.qZA())}function Q(n,i){if(1&n&&(t.TgZ(0,"h2",12),t._uU(1),t.qZA()),2&n){const r=t.oxw();t.xp6(1),t.hij(" Puede volver a escanear en ",r.segundos," segundos ")}}function R(n,i){if(1&n&&(t.TgZ(0,"h3",12),t._uU(1),t.qZA()),2&n){const r=t.oxw();t.xp6(1),t.hij(" Estacionamiento asignado ",r.est_asig," ")}}function M(n,i){1&n&&(t.TgZ(0,"h3",12),t._uU(1," Desvinculado de estacionamiento "),t.qZA())}function U(n,i){1&n&&(t.TgZ(0,"p"),t._uU(1,"\u231b Cargando..."),t.qZA())}const y=[{path:"",component:(()=>{var n;class i{constructor(s,e){this.fireEst=s,this.fireUsuarios=e,this.codigoQR="",this.encontrado=!1,this.bloqueoLecturaQR=!1,this.nroEst=0,this.est_asig=0,this.nroEstPref=0}ngOnInit(){this.fireUsuarios.obtenerDoc().subscribe(s=>{this.data=s,console.log("data",this.data)}),this.fireEst.obtenerDoc().subscribe(s=>{this.estacionamientos=s,console.log("estacionamientostotales",this.estacionamientos)})}onQRCodeScanned(s){var e=this;return(0,S.Z)(function*(){if(!e.bloqueoLecturaQR){e.bloqueoLecturaQR=!0,e.segundos=6,e.codigoQR=s[0].value;const a=e.codigoQR.split("//"),h=()=>{e.segundos--,e.segundos>0?setTimeout(h,1e3):e.bloqueoLecturaQR=!1};if(h(),e.estacionamientos.filter(m=>!0===m.disponible),2===a.length){(new Date).getTime(),e.email=a[1],e.uid=a[0];const p=e.estacionamientos.find(d=>d.email===e.email),l=e.data.find(d=>d.email===e.email);if(console.log("datos estacionado",l),p)console.log("usuario a actualizar",p),e.fireEst.updateDoc(p.id,{disponible:!0,email:"",patente:""}),e.fireUsuarios.updateDoc(l.id,{id_est:"",nro_est:0}),e.est_asig=0,e.fireEst.createDocRegHistoricoEstSalida({nro_est:p.nro_est,hora:new Date,usuario:e.email});else if(0==e.estacionamientos.filter(u=>!0===u.disponible).length)alert("no hay estacionamientos disponibles");else if(!0===l.preferencial)console.log("preferencial"),e.getEstDispPref2(),0==e.cantEstPref?(e.getEstDisp2(),console.log("id a actt",e.idEst,e.nroEst),e.fireEst.updateDoc(e.idEst,{disponible:!1,email:e.email,patente:"ABC12345"}),e.fireUsuarios.updateDoc(l.id,{id_est:e.idEst,nro_est:e.nroEst}),e.est_asig=e.nroEst,e.fireEst.createDocRegHistoricoEstEntrada({nro_est:e.est_asig,hora:new Date,usuario:e.email})):(console.log("id a act",e.idEstPref,e.nroEstPref),e.fireEst.updateDoc(e.idEstPref,{disponible:!1,email:e.email,patente:"ABC12345"}),e.fireUsuarios.updateDoc(l.id,{id_est:e.idEstPref,nro_est:e.nroEstPref}),e.est_asig=e.nroEstPref,e.fireEst.createDocRegHistoricoEstEntrada({nro_est:e.est_asig,hora:new Date,usuario:e.email}));else{console.log("no preferencial");const D=e.estacionamientos.filter(g=>!1===g.tipo).filter(g=>!0===g.disponible);console.log("veri",D),0==D.length?alert("No hay estacionamientos"):(e.getEstDisp2(),e.fireEst.updateDoc(e.idEst,{disponible:!1,email:e.email,patente:"ABC12345"}),e.fireUsuarios.updateDoc(l.id,{id_est:e.idEst,nro_est:e.nroEst}),e.est_asig=e.nroEst,e.fireEst.createDocRegHistoricoEstEntrada({nro_est:e.est_asig,hora:new Date,usuario:e.email}))}}e.fireUsuarios.obtenerDoc().subscribe(m=>{}),setTimeout(()=>{e.bloqueoLecturaQR=!1},6e3)}})()}getEstDisp(){this.fireEst.obtenerDoc().subscribe(s=>{s.some(e=>e.disponible!=e.tipo&&(this.idEst=e.id,this.nroEst=e.nro_est,this.encontrado=!0,console.log("id",this.idEst),this.idEst&&this.nroEst))})}getEstDisp2(){this.estacionamientos.some(s=>!(!s.disponible||1==s.tipo)&&(this.idEst=s.id,this.nroEst=s.nro_est,this.encontrado=!0,console.log("id",this.idEst),this.idEst&&this.nroEst))}getEstDispPref(){this.fireEst.obtenerDocPref().subscribe(s=>(console.log("estacionamientos",s),0==s.length?(this.cantEstPref=0,this.cantEstPref):(this.idEstPref=s[0].id,this.nroEstPref=s[0].nro_est,this.encontrado=!0,console.log("idPref",this.idEst,this.nroEst),this.idEstPref&&this.nroEstPref)))}getEstDispPref2(){this.encontrado=!1;for(const s of this.estacionamientos)if(!0===s.tipo&&!0===s.disponible){this.idEstPref=s.id,this.nroEstPref=s.nro_est,this.encontrado=!0,console.log("idPref",this.idEstPref,this.nroEstPref);break}this.encontrado||(this.cantEstPref=0,console.log("cantPref",this.cantEstPref))}}return(n=i).\u0275fac=function(s){return new(s||n)(t.Y36(Z.C),t.Y36(T.E))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-scanner"]],viewQuery:function(s,e){if(1&s&&t.Gf(x,5),2&s){let a;t.iGM(a=t.CRH())&&(e.scanner=a.first)}},decls:20,vars:9,consts:[[3,"translucent"],["src","../../../assets/estduoc.png",2,"height","100px","width","200px","margin","0 auto"],[1,"ion-padding",3,"fullscreen"],[2,"text-align","center"],[2,"position","relative","margin","0"],[3,"event"],["action","scanner"],[2,"margin-bottom","5vh"],[2,"display","flex","justify-content","center","align-items","center"],[3,"click"],[2,"width","100%","height","120px","background-color","#012c56"],["style","color: #fff",4,"ngIf"],[2,"color","#fff"],[4,"ngIf"]],template:function(s,e){if(1&s){const a=t.EpF();t.TgZ(0,"ion-header",0),t._UZ(1,"ion-img",1),t.qZA(),t.TgZ(2,"ion-content",2)(3,"h1",3),t._uU(4,"Scanner QR usuario"),t.qZA(),t.TgZ(5,"div",4)(6,"ngx-scanner-qrcode",5,6),t.NdJ("event",function(c){return e.onQRCodeScanned(c)}),t.qZA()(),t.TgZ(8,"div",7)(9,"div",8)(10,"ion-button",9),t.NdJ("click",function(){t.CHM(a);const c=t.MAs(7);return t.KtG(c.isStart?c.stop():c.start())}),t._uU(11),t.qZA()(),t.TgZ(12,"div",10),t.YNc(13,A,2,0,"h2",11),t.YNc(14,Q,2,1,"h2",11),t.TgZ(15,"h3",12),t._uU(16),t.qZA(),t.YNc(17,R,2,1,"h3",11),t.YNc(18,M,2,0,"h3",11),t.qZA(),t.YNc(19,U,2,0,"p",13),t.qZA()()}if(2&s){const a=t.MAs(7);t.Q6J("translucent",!0),t.xp6(2),t.Q6J("fullscreen",!0),t.xp6(9),t.hij(" ",a.isStart?"Detener":"Escanear"," "),t.xp6(2),t.Q6J("ngIf",0==e.segundos),t.xp6(1),t.Q6J("ngIf",e.segundos>0),t.xp6(2),t.hij("Escaneado : ",e.email,""),t.xp6(1),t.Q6J("ngIf",e.est_asig>0),t.xp6(1),t.Q6J("ngIf",0==e.est_asig),t.xp6(1),t.Q6J("ngIf",a.isLoading)}},dependencies:[E.d$,_.O5,f.YG,f.W2,f.Gu,f.Xz],styles:["*[_ngcontent-%COMP%]{color:#000}"]}),i})()}];let C=(()=>{var n;class i{}return(n=i).\u0275fac=function(s){return new(s||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[v.Bz.forChild(y),v.Bz]}),i})();(0,E.qM)().subscribe(n=>console.log("LOAD_WASM",n));let q=(()=>{var n;class i{}return(n=i).\u0275fac=function(s){return new(s||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[E.Mk,_.ez,b.u5,f.Pc,C]}),i})()}}]);